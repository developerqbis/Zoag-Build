import{o as ee,r as l,a as G,t as oe,X as ie,b as Y,j as K,c as i,B as ae,R as F,u as le,d as ce,L as A,x as H,$ as O,w as q,y as ue,U as de,E as ge,z as I,N as fe,e as me,O as he,I as pe,s as be,i as we,f as xe,g as ve,D as ye,h as Ee,k as Ce,C as ze,n as Re,l as Se,m as V}from"./index-p9DwFeKv.js";function je({defaultSelection:t}){const[b]=ee();return l.useEffect(()=>{b.focus(()=>{const a=document.activeElement,p=b.getRootElement();p===null||a!==null&&p.contains(a)||p.focus({preventScroll:!0})},{defaultSelection:t})},[t,b]),null}const Z=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],J=Z[Math.floor(Math.random()*Z.length)],te=l.createContext(null);function Ne(){return{color:J[1],isCollabActive:!1,name:J[0],yjsDocMap:new Map}}const ke=Ne();function De(t,b){let a=l.useContext(te);return a==null&&function(p,...k){const E=new URL("https://lexical.dev/docs/error"),C=new URLSearchParams;C.append("code",p);for(const y of k)C.append("v",y);E.search=C.toString(),console.warn(`Minified Lexical warning #${p}; visit ${E.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(319),a=a??ke,a}function Me({initialEditor:t,children:b,initialNodes:a,initialTheme:p,skipCollabChecks:k,skipEditableListener:E}){const C=l.useRef(!1),y=l.useContext(G);y==null&&function(h,...D){const r=new URL("https://lexical.dev/docs/error"),z=new URLSearchParams;z.append("code",h);for(const c of D)z.append("v",c);throw r.search=z.toString(),Error(`Minified Lexical error #${h}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(9);const[w,{getTheme:W}]=y,j=l.useMemo(()=>{const h=p||W()||void 0,D=oe(y,h);h!==void 0&&(t._config.theme=h),t._parentEditor=t._parentEditor||w;const r=t._createEditorArgs,z=r&&r.namespace;if(a){z||(t._config.namespace=w._config.namespace);for(let c of a){let M=null,x=null;if(typeof c!="function"){const n=c;c=n.replace,M=n.with,x=n.withKlass||null}const e=ie(t,c.getType());t._nodes.set(c.getType(),{exportDOM:e?e.exportDOM:void 0,klass:c,replace:M,replaceWithKlass:x,sharedNodeState:Y(c),transforms:K(c)})}}else if(r&&r.nodes)z||(t._config.namespace=w._config.namespace);else{const c=t._nodes=new Map(w._nodes);z||(t._config.namespace=w._config.namespace);for(const[M,x]of c)t._nodes.set(M,{exportDOM:x.exportDOM,klass:x.klass,replace:x.replace,replaceWithKlass:x.replaceWithKlass,sharedNodeState:Y(x.klass),transforms:K(x.klass)})}return[t,D]},[]),P=l.useContext(te),{isCollabActive:f,yjsDocMap:R}=P??{},_=k||C.current||R&&R.has(t.getKey());return l.useEffect(()=>{_&&(C.current=!0)},[_]),l.useEffect(()=>{if(!E){const h=D=>t.setEditable(D);return h(w.isEditable()),w.registerEditableListener(h)}},[t,w,E]),i.jsx(G.Provider,{value:j,children:!f||_?b:null})}function B(t,b,a){return Math.min(Math.max(t,b),a)}const o={east:1,north:8,south:2,west:4};function Le({onResizeStart:t,onResizeEnd:b,buttonRef:a,imageRef:p,maxWidth:k,editor:E,showCaption:C,setShowCaption:y,captionsEnabled:w}){const W=l.useRef(null),j=l.useRef({priority:"",value:"default"}),P=l.useRef({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),f=E.getRootElement(),R=k||(f!==null?f.getBoundingClientRect().width-20:100),_=f!==null?f.getBoundingClientRect().height-20:100,h=100,D=100,r=e=>{const n=e===o.east||e===o.west,s=e===o.north||e===o.south,N=e&o.north&&e&o.west||e&o.south&&e&o.east,v=n?"ew":s?"ns":N?"nwse":"nesw";f!==null&&f.style.setProperty("cursor",`${v}-resize`,"important"),document.body!==null&&(document.body.style.setProperty("cursor",`${v}-resize`,"important"),j.current.value=document.body.style.getPropertyValue("-webkit-user-select"),j.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},z=()=>{f!==null&&f.style.setProperty("cursor","text"),document.body!==null&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",j.current.value,j.current.priority))},c=(e,n)=>{if(!E.isEditable())return;const s=p.current,N=W.current;if(s!==null&&N!==null){e.preventDefault();const{width:v,height:S}=s.getBoundingClientRect(),d=F(s),g=P.current;g.startWidth=v,g.startHeight=S,g.ratio=v/S,g.currentWidth=v,g.currentHeight=S,g.startX=e.clientX/d,g.startY=e.clientY/d,g.isResizing=!0,g.direction=n,r(n),t(),N.classList.add("touch-action-none"),s.style.height=`${S}px`,s.style.width=`${v}px`,document.addEventListener("pointermove",M),document.addEventListener("pointerup",x)}},M=e=>{const n=p.current,s=P.current,N=s.direction&(o.east|o.west),v=s.direction&(o.south|o.north);if(n!==null&&s.isResizing){const S=F(n);if(N&&v){let d=Math.floor(s.startX-e.clientX/S);d=s.direction&o.east?-d:d;const g=B(s.startWidth+d,h,R),X=g/s.ratio;n.style.width=`${g}px`,n.style.height=`${X}px`,s.currentHeight=X,s.currentWidth=g}else if(v){let d=Math.floor(s.startY-e.clientY/S);d=s.direction&o.south?-d:d;const g=B(s.startHeight+d,D,_);n.style.height=`${g}px`,s.currentHeight=g}else{let d=Math.floor(s.startX-e.clientX/S);d=s.direction&o.east?-d:d;const g=B(s.startWidth+d,h,R);n.style.width=`${g}px`,s.currentWidth=g}}},x=()=>{const e=p.current,n=P.current,s=W.current;if(e!==null&&s!==null&&n.isResizing){const N=n.currentWidth,v=n.currentHeight;n.startWidth=0,n.startHeight=0,n.ratio=0,n.startX=0,n.startY=0,n.currentWidth=0,n.currentHeight=0,n.isResizing=!1,s.classList.remove("touch-action-none"),z(),b(N,v),document.removeEventListener("pointermove",M),document.removeEventListener("pointerup",x)}};return i.jsxs("div",{ref:W,children:[!C&&w&&i.jsx(ae,{className:"image-caption-button absolute bottom-1 left-1/2 -translate-x-1/2",ref:a,variant:"outline",onClick:()=>{y(!C)},children:"Add Caption"}),i.jsx("div",{className:"image-resizer image-resizer-n bg-primary absolute -top-2.5 left-1/2 h-2 w-2 -translate-x-1/2 cursor-ns-resize",onPointerDown:e=>{c(e,o.north)}}),i.jsx("div",{className:"image-resizer image-resizer-ne bg-primary absolute -top-2.5 -right-2.5 h-2 w-2 cursor-nesw-resize",onPointerDown:e=>{c(e,o.north|o.east)}}),i.jsx("div",{className:"image-resizer image-resizer-e bg-primary absolute top-1/2 -right-2.5 h-2 w-2 -translate-y-1/2 cursor-ew-resize",onPointerDown:e=>{c(e,o.east)}}),i.jsx("div",{className:"image-resizer image-resizer-se bg-primary absolute -right-2.5 -bottom-2.5 h-2 w-2 cursor-nwse-resize",onPointerDown:e=>{c(e,o.south|o.east)}}),i.jsx("div",{className:"image-resizer image-resizer-s bg-primary absolute -bottom-2.5 left-1/2 h-2 w-2 -translate-x-1/2 cursor-ns-resize",onPointerDown:e=>{c(e,o.south)}}),i.jsx("div",{className:"image-resizer image-resizer-sw bg-primary absolute -bottom-2.5 -left-2.5 h-2 w-2 cursor-nesw-resize",onPointerDown:e=>{c(e,o.south|o.west)}}),i.jsx("div",{className:"image-resizer image-resizer-w bg-primary absolute top-1/2 -left-2.5 h-2 w-2 -translate-y-1/2 cursor-ew-resize",onPointerDown:e=>{c(e,o.west)}}),i.jsx("div",{className:"image-resizer image-resizer-nw bg-primary absolute -top-2.5 -left-2.5 h-2 w-2 cursor-nwse-resize",onPointerDown:e=>{c(e,o.north|o.west)}})]})}const T=new Set,Q=Se("RIGHT_CLICK_IMAGE_COMMAND");function Pe(t){if(!T.has(t))throw new Promise(b=>{const a=new Image;a.src=t,a.onload=()=>{T.add(t),b(null)},a.onerror=()=>{T.add(t)}})}function _e({altText:t,className:b,imageRef:a,src:p,width:k,height:E,maxWidth:C,onError:y}){return Pe(p),i.jsx("img",{className:b||void 0,src:p,alt:t,ref:a,style:{height:E,maxWidth:C,width:k},onError:y,draggable:"false"})}function $e(){return i.jsx("img",{src:"",style:{height:200,opacity:.2,width:200},draggable:"false"})}function We({src:t,altText:b,nodeKey:a,width:p,height:k,maxWidth:E,resizable:C,showCaption:y,caption:w,captionsEnabled:W}){const j=l.useRef(null),P=l.useRef(null),[f,R,_]=le(a),[h,D]=l.useState(!1);De();const[r]=ee(),[z,c]=l.useState(null),M=l.useRef(null),[x,e]=l.useState(!1),n=ce(),s=l.useCallback(m=>{const u=A();return f&&H(u)&&(m.preventDefault(),r.update(()=>{u.getNodes().forEach($=>{O($)&&$.remove()})})),!1},[r,f]),N=l.useCallback(m=>{const u=A(),L=P.current;if(f&&H(u)&&u.getNodes().length===1){if(y)return q(null),m.preventDefault(),w.focus(),!0;if(L!==null&&L!==document.activeElement)return m.preventDefault(),L.focus(),!0}return!1},[w,f,y]),v=l.useCallback(m=>M.current===w||P.current===m.target?(q(null),r.update(()=>{R(!0);const u=r.getRootElement();u!==null&&u.focus()}),!0):!1,[w,r,R]),S=l.useCallback(m=>{const u=m;return h?!0:u.target===j.current?(u.shiftKey?R(!f):(_(),R(!0)),!0):!1},[h,f,R,_]),d=l.useCallback(m=>{r.getEditorState().read(()=>{const u=A();m.target.tagName==="IMG"&&ue(u)&&u.getNodes().length===1&&r.dispatchCommand(Q,m)})},[r]);l.useEffect(()=>{let m=!0;const u=r.getRootElement(),L=de(r.registerUpdateListener(({editorState:$})=>{m&&c($.read(()=>A()))}),r.registerCommand(we,($,ne)=>(M.current=ne,!1),I),r.registerCommand(be,S,I),r.registerCommand(Q,S,I),r.registerCommand(pe,$=>$.target===j.current?($.preventDefault(),!0):!1,I),r.registerCommand(he,s,I),r.registerCommand(me,s,I),r.registerCommand(fe,N,I),r.registerCommand(ge,v,I));return u==null||u.addEventListener("contextmenu",d),()=>{m=!1,L(),u==null||u.removeEventListener("contextmenu",d)}},[_,r,h,f,a,s,N,v,S,d,R]);const g=()=>{r.update(()=>{const m=V(a);O(m)&&m.setShowCaption(!0)})},X=(m,u)=>{setTimeout(()=>{D(!1)},200),r.update(()=>{const L=V(a);O(L)&&L.setWidthAndHeight(m,u)})},re=()=>{D(!0)},se=f&&H(z)&&!h,U=(f||h)&&n;return i.jsx(l.Suspense,{fallback:null,children:i.jsxs(i.Fragment,{children:[i.jsx("div",{draggable:se,children:x?i.jsx($e,{}):i.jsx(_e,{className:`max-w-full cursor-default ${U?`${H(z)?"draggable cursor-grab active:cursor-grabbing":""} focused ring-primary ring-2 ring-offset-2`:null}`,src:t,altText:b,imageRef:j,width:p,height:k,maxWidth:E,onError:()=>e(!0)})}),y&&i.jsx("div",{className:"image-caption-container absolute right-0 bottom-1 left-0 m-0 block min-w-[100px] overflow-hidden border-t bg-white/90 p-0",children:i.jsxs(Me,{initialEditor:w,initialNodes:[xe,ve,ye],children:[i.jsx(je,{}),i.jsx(Ee,{}),i.jsx(Ce,{contentEditable:i.jsx(ze,{className:"ImageNode__contentEditable user-select-text word-break-break-word caret-primary relative block min-h-5 w-[calc(100%-20px)] cursor-text resize-none border-0 p-2.5 text-sm whitespace-pre-wrap outline-none",placeholderClassName:"ImageNode__placeholder text-sm text-muted-foreground overflow-hidden absolute top-2.5 left-2.5 pointer-events-none text-ellipsis user-select-none whitespace-nowrap inline-block",placeholder:"Enter a caption..."}),ErrorBoundary:Re})]})}),C&&H(z)&&U&&i.jsx(Le,{showCaption:y,setShowCaption:g,editor:r,buttonRef:P,imageRef:j,maxWidth:E,onResizeStart:re,onResizeEnd:X,captionsEnabled:!x&&W})]})})}export{Q as RIGHT_CLICK_IMAGE_COMMAND,We as default};
